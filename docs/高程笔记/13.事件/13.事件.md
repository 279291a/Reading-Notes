# 13.事件

[toc]

## 13.1 事件流

**定义**：从页面中接受事件的顺序。`IE`的事件流是冒泡流，而`Netscape`是事件捕获流。

**事件冒泡**：由最具体的元素接收，逐渐向上传播到最不具体的元素。
**事件捕获**：不太具体的元素先接收到事件，而最具体的节点应该最后接收到事件。
**DOM 事件流**包括**三**个阶段，事件捕获阶段，处于目标阶段和事件冒泡阶段。

## 13.2 事件处理程序

### 概念

**事件**：用户或者浏览器自身执行的某种动作。
**事件处理程序**：响应某个事件的函数，也叫作**事件侦听器**。

### `HTML`事件处理程序

`HTML`事件处理程序，定义时可以包含具体要执行的代码，或者调用页面其他地方调用的脚本。这个函数内部，`this`值等于事件的目标元素。

```javascript
<button id="btn" click="alert('click')">
  click me
</button>
```

**缺点**：

1. 可能由于脚本引用顺序的时差而引发错误，例如事件处理程序中包含的函数还未载入。
2. 扩展事件处理程序的作用域链在不同浏览器中会导致不同的结果。
3. `html`与`javascript`紧密耦合，这也是摈弃`html`事件处理程序的原因。

### `DOM0`级事件处理程序

将函数赋值给一个事件处理程序。

```javascript
var btn = document.getElementById("btn");
btn.onclick = function() {
  alert("click");
};
```

**优点**：1.简单 2. 跨浏览器
**删除事件处理程序**：通过将其属性值设置为`null`

```javascript
btn.onclick = null;
```

### `DOM2`级事件处理程序

**方法：**用于处理指定和删除事件处理程序的操作：`addEventListener()`和`removeEventListener()`.

**参数：**处理时间名、事件处理程序的函数和 一个布尔值。为`true`是，表示在捕获阶段调用事件处理程序，如果为`false`,表示在冒泡阶段调用事件处理程序。

**优点**：添加多个事件处理程序。

**删除：**使用`removeEventListener()`来移除，在移除时传入的参数和添加事件处理程序使用的参数相同。通过`addEventListener()`添加的匿名函数无法移除。

**使用建议**： 最后一个参数传入 false ,也就是将事件处理程序添加到事件流的冒泡阶段，可以最大限度的兼容各种浏览器。

### IE 事件处理程序

1. **方法**: `addEvent()`和 `detachEvent()`，接收**参数**：事件处理程序名称和事件处理程序函数。事件会**被添加到事件流的冒泡阶段**。
2. **IE 中方法 与 dom 0 级方法的区别**：事件的作用域。在 **DOM 0 级**，事件处理程序会在所属元素的作用域内进行，在使用 `attachEvent()` 方法时，事件处理程序会在全局作用域中记性，因此`this` 等于 `window`
3. **优点**：可以为一个元素添加多个事件处理程序
4. **执行顺序**： 多个事件处理程序以添加顺序相反的顺序被触发。
5. **删除事件处理程序**：使用`detachEvent()`来移除，必须提供相同的参数，添加的匿名函数不能被移除。
   ##13.3 事件对象
   触发`DOM`上的某个事件时，会产生一个事件对象`event`,这个对象包含着所有与事件相关的信息。不同浏览器对事件对象的支持方式不同。

### DOM 中的事件对象

兼容 DOM 的浏览器会将一个 event 对象传入到事件处理程序中。不论指定事件的方式是 DOM0 级 还是 DOM 2 级。
**`this`，`target`，`currentTarget`三者关系**： 在事件处理程序内部，**this 始终等于 currentTarget 的值，target 则包含事件的实际目标**，如果直接将事件处理程序指定给目标元素，三者相等。
**取消默认行为：**`cancleable`属性为 true 的事件，可以通过 **preventDefault()** 方法来取消默认行为。
**取消进一步事件捕获和冒泡：**通过**stopPropagation()**来停止。
**事件流阶段**：事件对象的 eventPhase 属性，可以确定处于事件流的哪个阶段。该属性等于 1，处于捕获阶段。该属性等于 2，处于目标阶段，该属性等于 3，处于冒泡阶段。

### IE 中的事件对象

**访问 IE 事件对象的方式**：取决于指定事件处理程序的方法。

1. 使用**DOM0 级**添加事件处理程序时，**event 对象作为 window 对象的一个属性存在。**
   `javascript link.onclick = function(){ var event = window.event; };`
2. 使用**attachEvent**添加，**event 对象作为参数被传入事件处理程序**。

   ```javascript
   btn.attachEvent("onclick", funcrion(event) {
   ...
   });
   ```

3. 使用**HTML**指定，通过**event 变量来访问**

   ```htmlbars
   <input type="button" value="click me" onclick="alert(event.type)">
   ```

**属性和方法**

![Alt text](./1553218453329.png)

**取消事件默认行为**：将 returnValue 设置为 false

```javascript
link.onclick = function() {
  window.event.returnValue = false;
};
```

**取消事件冒泡**： 将`cancelBubble`设置为`true`

```javascript
window.event.cancelBubble = true;
```

## 13.2 事件类型

**一、DOM3 级规定的几类事件**

- **UI 事件**，用户与页面元素进行交互
- **焦点事件**，元素获得或失去焦点
- **鼠标事件**，使用鼠标在页面上执行操作
- **滚轮事件**，使用鼠标滚轮时触发
- **文本事件**，输入文本触发
- **键盘事件**，在键盘执行操作时触发
- **合成事件**，当输入法编辑器输入字符时触发
- **变动事件**，底层 DOM 结构发生变化触发
- ~~**变动名称事件**，元素或属性名变动时触发，已废弃~~

### UI 事件

- ~~**DOMActive：**表示元素被用户操作激活，已废弃~~
- **load**：加载完毕后触发，可能在`window`，图像，框架集等元素上触发。
- **unload**：卸载后触发。
- **abort**： 用户停止下载或没有加载完，则在元素上触发。
- **error**：发生错误时触发
- **select**： 用户选择文本框中的一个或多个字符时触发。
- **resize**: 窗口或者框架大小变化时在 window 或框架上触发。
- **scroll**： 当用户滚动带滚动条元素中的内容时触发。

#### **一、 load 事件**

**触发时机**

1. 当页面完全加载后，会触发 window 上的 load 事件。
2. 图像加载完毕
3. 在 IE9 以上，`<script>` 上可以触发
4. IE 和 Opera ，`<link>`元素可以触发

**定义 onload 的两种方式**：

1. 给 window 对象 onload 事件绑定事件处理程序，建议使用这种方式
2. 为 body 元素添加一个 onload 特性

#### **二、unload 事件**

**触发时机**：文档被完全卸载后触发。例如，切换页面就会触发 unload 事件。

**定义 onunload 的两种方式**

1. 给 window 对象的 onunload 事件添加事件处理程序，建议使用这种方式。
2. 为 body 元素添加一个 onunload 特性

#### 三、resize 事件 {#resize}

**触发：**浏览器窗口被调整到一个新的高度或宽度时触发。

**定义方式**

1. 给 window 对象的 onresize 添加
2. 给 `<body>`元素中的 onresize 特性来指定事件处理程序。

**建议：**不要在 resize 事件处理程序中加入计算量大的代码，可能导致反应变慢。

#### **四、scroll 事件**

**触发**：带滚动条元素滚动时触发

**定义方式**：同样有两种定义方式，[参考四中定义方式](#resize)

**建议**：scroll 事件在滚动期间被重复触发，需要保持事件处理程序的代码简单。

### 焦点事件

- **blur**: 失去焦点时触发，不会冒泡
- **foucus**: 元素获得焦点时触发，不冒泡
- **foucusin**: 元素获得焦点时触发，支持冒泡
- **foucusout**： 元素失去焦点时触发，是 HTML 事件 blur 的通用版本
- ~~**DOMFocusIn** 在元素获得焦点时触发，已废弃，使用 focusin 代替~~
- ~~**DOMFocusOut** 元素失去焦点时触发，已废弃，使用 foucuout 代替~~

### 鼠标和滚轮事件

- **click** 单击鼠标主按钮或按下回车时触发
- **dbclick** 双击鼠标主按钮触发
- **mousedown** 按下任意鼠标按钮触发
- **mouseenter** 光标从元素外部首次移动到元素内部时触发，但是这个事件不冒泡。
- **mouseleave** 位于元素上方的光标移动到元素范围之外时触发，不支持冒泡。
- **mousemove** 鼠标指针在元素内部移动时，重复触发。
- **mouseout** 鼠标指针从一个元素移动到另一个元素时触发。
- **mouseover** 鼠标指针元素外部首次移入另一个元素边界内触发。
- **mouseup** 鼠标按钮释放时触发。
- **mousewheel** 滚轮事件

#### **坐标：**

**客户端坐标**：表示 事件发生时鼠标指针在视口中的水平和垂直坐标，保存在事件对象的 clienX 和 clientY。
**页面坐标**： 表示事件发生时指针在页面的水平和垂直坐标，保存在事件对象的 pageX 和 pageY.
**屏幕坐标**： 事件发生时，鼠标指针相对于整个屏幕的坐标信息，保存在事件对象的 screenX 和 screenY .

**修改键：**记录修改键是否被按下，保存在事件对象的 shiftKey、ctrlKey、altKey 和 metaKey 中。包含的都是布尔值。

**相关元素**：在 mouseout 和 mouseover 事件时，涉及到光标从一个元素移动到另一个元素之内。除去目标元素的另一个元素叫做相关元素。保存在 event 对象的 relatedTarget 属性。在 IE 中则保存在 fromElement 或 toElement 属性中。

**鼠标按键指示**： 在 mousedown 和 mouseup 事件中，event 对象的 button 属性保存按下或释放的按钮。值为 0 表示主按钮，1 表示滚轮，2 表示次按钮。
