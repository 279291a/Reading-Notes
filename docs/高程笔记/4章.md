# 变量、作用域与内存

## 原始值和引用值

### 基本概念

**_变量_** 可以包含两种不同的类型，原始值和引用值。

**_原始值_** 就是基本数据类型的值。

**_引用值_** 是有多个值构成的对象。

**_按值访问_** 保存原始值的变量时按值访问的，操作变量时，实际操作的是存储在变量中的实际值。

**_按引用访问_** JavaScript 不允许直接访问内存位置，也就不能操作对象所在的内存空间。在操作对象时，实际上操作的是该对象的引用而非实际的对象本身。

### 动态属性

- 引用值可以随时添加，修改和删除其属性和方法。
- 原始值不能够有属性，但是对原始值添加方法不会报错。
- 如果使用 `new`关键字，则创建的是一个 `Object` 类型的实例，但其行为类似原始值。

### 复制值

- 原始值在复制时，原始值会被复制到新变量的位置。两个变量可以独立使用，互不干扰。
- 把引用值从一个变量赋值给另一个变量值，实际上是将存储在变量中的指针地址复制给新变量。实际上，两个变量指向同一个对象，因此一个对象的变化会在另一个对象上反映出来。

### 传递参数

ECMAScript 中的参数是 **按值传递** 的。函数外的值会**按照变量复制值**的方式来被复制到函数内部的参数中。所以，如果传入函数的参数是对象，那么在函数内对改参数的修改，会在该对象中反映出来。

```js
function setName(person) {
  person.name = "Gold";
}
let obj = {};
setName(obj);
console.log(obj.name); //Gold
```

### 确定类型

- `typeof`用于判断变量是否为原始类型
- `instanceof`用来判断变量是否为给定的引用类型的实例

## 执行上下文与作用域

### 基本概念

**_执行上下文_** 决定了可以访问哪些数据和方法。

**_变量对象_** ，每个上下文都有一个相关的变量对象，存储着上下文中定义的所有变量和函数。

**_作用域链_** 决定了各级上下文中代码在访问变量和函数时的顺序。代码正在执行的上下文的变量对象始终位于作用域链的最前端，以此类推往上寻找，直至找到全局上下文。

### 作用域链增强

**_作用域链增强_** ，某些语句会导致在作用域链前端临时添加一个上下文，在代码执行后被删除。

- `try-catch` 中的 `catch` 语句，创建一个新的变量对象，该对象包含要抛出的错误对象的声明。
- `with` 语句，向作用域链前端添加指定的对象。

## 垃圾回收

**_垃圾回收_** 指的是执行执行环境负责在代码执行时管理内存，无需开发者手动管理内存。JavaScript 是使用垃圾回收的语言。垃圾回收机制首先确定哪个变量不再使用，就释放它所占的内存。这个过程是 **周期性** 的。

标记未使用变量的两种主要方式： **标记清理**、**引用计数**。

### 标记清理

**_标记清理_** 就是当变量进入上下文，则加上存在于上下文中的标记。当变量离开上下文，则加上离开上下文的标记。逻辑上来说，永远不清理存在于上下文中的变量。

### 引用计数

**_引用计数_** 就是对每个值都记录它被引用的次数，当一个值的引用数为 0 时，安全回收其内存。

#### 循环引用

**_引用计数_** 无法处理循环引用的情况，导致内存没有被回收。
